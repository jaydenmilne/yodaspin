<html>
    <head>
        
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="yoda.css">
        <title>
            YODA SPIN    
        </title>
        <link href="https://fonts.googleapis.com/css2?family=Staatliches&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Overpass+Mono:wght@600&display=swap" rel="stylesheet">
    </head>
    <body>
        <canvas id="canvas" style="width: 100%; height: 100%; padding: 0;margin: 0;"></canvas>
        <img id="yoda" src="yoda.png">

        <div id="outer-div">
            <div id="counter">0</div>
            <div id="reverse-layout">
                <div id="bottom-bar">
                    <span class="bottom-feeder">Made by Jayden Milne</span>
                    <span class="bottom-feeder"><a href="https://github.com/jaydenmilne/yodaspin">Source</a></span>
                    <span class="bottom-feeder"><a href="https://medium.com/better-programming/fun-with-html-canvas-lets-create-a-star-field-a46b0fed5002">Star field</a></span>
                    <span class="bottom-feeder">Tap for jams</span>
                </div>
                <div id="messages">
                    Hello there
                </div>
                <div id="countdown">
                    10:00:00
                </div>
            </div>
        </div>

        <script src="spin.js"></script> 
        <script>
            // Liberated from https://medium.com/better-programming/fun-with-html-canvas-lets-create-a-star-field-a46b0fed5002
            const canvas = document.getElementById("canvas");
            const c = canvas.getContext("2d");
        
            let w;
            let h;
        
            const setCanvasExtents = () => {
              w = document.body.clientWidth;
              h = document.body.clientHeight;
              canvas.width = w;
              canvas.height = h;
            };
        
            setCanvasExtents();
        
            window.onresize = () => {
              setCanvasExtents();
            };
        
            const makeStars = count => {
              const out = [];
              for (let i = 0; i < count; i++) {
                const s = {
                  x: Math.random() * 1600 - 800,
                  y: Math.random() * 900 - 450,
                  z: Math.random() * 1000
                };
                out.push(s);
              }
              return out;
            };
        
            let stars = makeStars(10000);
        
            const clear = () => {
              c.fillStyle = "black";
              c.fillRect(0, 0, canvas.width, canvas.height);
            };
        
            const putPixel = (x, y, brightness) => {
              const intensity = brightness * 255;
              const rgb = "rgb(" + intensity + "," + intensity + "," + intensity + ")";
              c.fillStyle = rgb;
              c.fillRect(x, y, 2, 2);
            };
        
            const moveStars = distance => {
              const count = stars.length;
              for (var i = 0; i < count; i++) {
                const s = stars[i];
                s.z -= distance;
                while (s.z <= 1) {
                  s.z += 1000;
                }
              }
            };
        
            let prevTime;
            const init = time => {
              prevTime = time;
              requestAnimationFrame(tick);
            };
        
            const tick = time => {
              let elapsed = time - prevTime;
              prevTime = time;
        
              moveStars(elapsed * 0.1);
        
              clear();
        
              const cx = w / 2;
              const cy = h / 2;
        
              const count = stars.length;
              for (var i = 0; i < count; i++) {
                const star = stars[i];
        
                const x = cx + star.x / (star.z * 0.001);
                const y = cy + star.y / (star.z * 0.001);
        
                if (x < 0 || x >= w || y < 0 || y >= h) {
                  continue;
                }
        
                const d = star.z / 1000.0;
                const b = 1 - d * d;
        
                putPixel(x, y, b);
              }
        
              requestAnimationFrame(tick);
            };
        
            requestAnimationFrame(init);
          </script>
    </body>

</html>